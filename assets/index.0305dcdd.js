import{o as l,c as g,u as V,R as A,a as u,F as m,r as x,n as y,b as S,t as d,d as o,w,v,e as _,f as j,g as O,h as k,i as E,j as N,k as P,V as I,l as H}from"./vendor.75ed90a5.js";const L=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}};L();const R={setup(t){return(e,r)=>(l(),g(V(A)))}},q="modulepreload",T={},M="/",W=function(e,r){return!r||r.length===0?e():Promise.all(r.map(a=>{if(a=`${M}${a}`,a in T)return;T[a]=!0;const s=a.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${n}`))return;const i=document.createElement("link");if(i.rel=s?"stylesheet":q,s||(i.as="script",i.crossOrigin=""),i.href=a,document.head.appendChild(i),s)return new Promise((h,c)=>{i.addEventListener("load",h),i.addEventListener("error",c)})})).then(()=>e())};var f=(t,e)=>{const r=t.__vccOpts||t;for(const[a,s]of e)r[a]=s;return r};const z={name:"ChatElement",props:{current_chat:Array,username:String},methods:{},watch:{current_chat:{deep:!0,handler:function(t,e){setTimeout(()=>{var r=this.$refs.container;r.scrollTop=r.scrollHeight+2e3},50)}}}},D={class:"imessage flex flex-col mt-auto overflow-scroll",ref:"container"},K={class:"text-[12px]"};function B(t,e,r,a,s,n){return l(),u("div",D,[(l(!0),u(m,null,x(r.current_chat,(i,h)=>(l(),u("p",{key:i,class:y(i.username==r.username?"from-me":"from-them")},[S(d(i.text)+" ",1),o("div",K,d(i.username),1)],2))),128))],512)}var J=f(z,[["render",B],["__scopeId","data-v-3b0333dc"]]);const $={name:"home",emits:["addTube"],data(){return{tube_id:"",error_text:""}},methods:{continue:function(){},closeWindow:function(){this.$emit("close"),this.tube_id="",this.error_text=""},addTube:function(){this.tube_id!==""?this.$emit("addTube",this.tube_id):this.error_text="Diesen Tube gibt es nicht."}}},F={class:"h-screen w-screen absolute grid place-items-center"},U={class:"bg-white opacity-100 z-40 w-96 h-60 absolute rounded-2xl grid place-items-center"},G=o("div",{class:"border-b-2 border-black-900 flex flex-row"},[o("p",{class:"flex flex-row mt-3 text-gray-700 font-bold text-lg mb-3 ml-auto mr-auto"}," Tube hinzuf\xFCgen ")],-1),Q={class:"flex flex-row items-center mt-5"},X={class:"mt-2 text-blue-800 font-bold"},Y={class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-full inline-flex mt-4 mb-5"},Z=o("i",{class:"f7-icons inset-y-0 font-light gray"}," arrow_right_circle_fill ",-1);function ee(t,e,r,a,s,n){return l(),u("div",F,[o("div",{class:"bg-black opacity-60 z-30 h-screen w-screen absolute",onClick:e[0]||(e[0]=(...i)=>n.closeWindow&&n.closeWindow(...i))}),o("div",U,[G,o("div",Q,[w(o("input",{class:"appearance-none rounded-xl py-3 px-5 text-black-700 leading-tight focus:outline-none outline-0 text-xl bg-gray-200 min-w-[300px] ml-auto mr-auto",type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>s.tube_id=i),placeholder:"tube id"},null,512),[[v,s.tube_id]])]),o("p",X,d(s.error_text),1),o("button",Y,[Z,o("span",{tag:"button",class:"ml-2 font-weight text-xl",onClick:e[2]||(e[2]=(...i)=>n.addTube&&n.addTube(...i))}," Weiter ")])])])}var te=f($,[["render",ee]]);async function se(){return await fetch("http://127.0.0.1:4001/check_auth",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({token:localStorage.getItem("token")})}).then(e=>e.json()).then(e=>e.token).catch(e=>!1)}async function ne(){return await fetch("http://127.0.0.1:4001/check_auth",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({token:localStorage.getItem("token")})}).then(e=>e.json()).then(e=>e).catch(e=>!1)}function oe(t,e,r){for(;e<0;)e+=t.length;for(;r<0;)r+=t.length;if(r>=t.length)for(var a=r-t.length+1;a--;)t.push(void 0);return t.splice(r,0,t.splice(e,1)[0]),t}var re="/assets/no_chat.8adbd187.svg";const ie={name:"home",data(){return{username:"",message:"",add_task_view:!1,current_tube_index:0,tubes:[{tube_id:"main",name:"Hauptkanal"}],current_chat:[]}},methods:{logout:function(){localStorage.removeItem("token"),this.$router.push({path:"/auth"})},moveToTop:function(t){oe(this.tubes,t,0)},showAddTubeView:function(){this.add_task_view=!this.add_task_view},addTube:function(t){this.showAddTubeView(),this.tubes.push({tube_id:t,name:t})},emitMessage:function(){fetch("http://127.0.0.1:4001/emit",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({room:this.tubes[this.current_tube_index].tube_id,message:this.message,token:localStorage.getItem("token")})}).then(t=>t.json()).then(t=>{}).catch(t=>{console.log("Request failed",t)})},selectTube:function(t,e){this.$socket.emit("unsubscribe",this.tubes[this.current_tube_index].tube_id),this.current_tube_index=e,this.$socket.emit("subscribe",this.tubes[this.current_tube_index].tube_id),this.current_chat=[],this.fetchTubeHistory()},fetchTubeHistory:function(){fetch("http://127.0.0.1:4001/get_tube",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({tube_id:this.tubes[this.current_tube_index].tube_id,token:localStorage.getItem("token")})}).then(t=>t.json()).then(t=>{console.log(t),this.current_chat=t.messages}).catch(t=>{console.log("Request failed",t)})}},sockets:{connect:function(){},message:function(t){this.current_chat.push({text:t.message,username:t.author})}},components:{ChatElement:J,NewChatView:te},mounted:async function(){const t=await ne();this.username=t.user.username,this.$socket.emit("subscribe",this.tubes[this.current_tube_index].tube_id),this.fetchTubeHistory()}},ae={class:"flex justify-center bg-individual h-screen p-10"},ce={class:"flex flex-row w-11/12 bg-white rounded-xl shadow-2xl"},le={class:"flex flex-col bg-white-800 w-96 border-r-2 border-black-900"},ue={class:"flex flex-row border-b-2 border-black-900 w-full justify-between static"},de={class:"text-xl text-indigo font-sans mt-3 ml-2 px-3 py-2 mb-3"},he={class:"mt-3"},me=["onClick"],_e={class:"text-base text-black font-extrabold"},fe={class:"text-base text-slate-400 font-regular"},be={key:0,class:"flex flex-col w-full"},pe={class:"flex flex-row border-b-2 border-black-900 w-full justify-between"},ge={class:"text-xl text-indigo font-sans mt-2 px-3 py-2 mb-4"},xe={class:"flex items-center"},ye={class:"mr-5 bg-gray-800 text-white p-1.5 px-3 rounded-full"},we={class:"flex flex-row border-t-2 border-black-900 w-full justify-between static"},ve={key:1,class:"grid content-center mr-auto ml-auto"},ke=o("img",{src:re,alt:"alt",class:"w-36 ml-auto mr-auto"},null,-1),Te=o("p",{class:"mt-10 text-gray-700 font-light text-3xl ml-auto mr-auto"}," Hier ist es aber leise... ",-1),Ce=o("span",{tag:"button",class:"font-weight text-xl"},"Tube hinzuf\xFCgen",-1),Ve=[Ce];function Ae(t,e,r,a,s,n){const i=k("NewChatView"),h=k("ChatElement");return l(),u(m,null,[s.add_task_view?(l(),g(i,{key:0,onAddTube:n.addTube,onClose:n.showAddTubeView},null,8,["onAddTube","onClose"])):_("",!0),o("div",ae,[o("div",ce,[o("div",le,[o("div",ue,[o("p",de,d(s.username),1),o("div",he,[o("i",{class:"f7-icons mr-2 inset-y-0 font-light hover:bg-gray-200 hover:cursor-pointer p-2 rounded-full",onClick:e[0]||(e[0]=(...c)=>n.logout&&n.logout(...c))}," lock "),o("i",{class:"f7-icons inset-y-0 mr-2 font-light hover:bg-gray-200 hover:cursor-pointer p-2 rounded-full",onClick:e[1]||(e[1]=(...c)=>n.showAddTubeView&&n.showAddTubeView(...c))}," paperplane ")])]),(l(!0),u(m,null,x(s.tubes,(c,p)=>(l(),u("div",{class:"flex flex-col max-h-90 overflow-auto",key:c.tube_id},[o("div",{onClick:je=>n.selectTube(c,p),class:y(["h-15 px-5 py-5",p==s.current_tube_index?"bg-gray-200":"bg-white"])},[o("p",_e,d(c.name),1),o("p",fe,d(c.tube_id),1)],10,me)]))),128))]),s.tubes.length>0?(l(),u("div",be,[o("div",pe,[o("p",ge,d(s.tubes[s.current_tube_index].name),1),o("div",xe,[o("p",ye,d(this.tubes[this.current_tube_index].tube_id),1)])]),j(h,{current_chat:s.current_chat,username:s.username},null,8,["current_chat","username"]),o("div",we,[w(o("input",{class:"appearance-none rounded w-full py-2 px-3 ml-4 text-black-700 leading-tight focus:outline-none outline-0 text-xl",type:"text",placeholder:"Geben Sie eine Nachricht ein...",onKeyup:e[2]||(e[2]=O((...c)=>n.emitMessage&&n.emitMessage(...c),["enter"])),"onUpdate:modelValue":e[3]||(e[3]=c=>s.message=c)},null,544),[[v,s.message]]),o("i",{class:"f7-icons mt-5 ml-2 inset-y-0 mr-4 font-light mb-5",onClick:e[4]||(e[4]=(...c)=>n.emitMessage&&n.emitMessage(...c))}," paperplane_fill ")])])):_("",!0),s.tubes.length==0?(l(),u("div",ve,[ke,Te,o("button",{onClick:e[5]||(e[5]=(...c)=>n.showAddTubeView&&n.showAddTubeView(...c)),class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-full inline-flex mt-10 w-50 mr-auto ml-auto"},Ve)])):_("",!0)])])],64)}var Se=f(ie,[["render",Ae]]);const C=E({history:N("/"),routes:[{path:"/",name:"home",component:Se,meta:{requiresAuth:!0}},{path:"/auth",name:"auth",component:()=>W(()=>import("./AuthView.a613ce7d.js"),["assets/AuthView.a613ce7d.js","assets/AuthView.fecce7df.css","assets/vendor.75ed90a5.js"])}]});C.beforeEach(async(t,e,r)=>{var a=await se();console.log(a),t.matched.some(s=>s.meta.requiresAuth)?a?r():r({name:"auth"}):r()});const b=P(R);b.use(C);b.use(new I({debug:!0,connection:H("http://localhost:4001"),vuex:{actionPrefix:"SOCKET_",mutationPrefix:"SOCKET_"}}));b.mount("#app");export{f as _};
