import{o as l,c as x,u as A,R as S,a as u,F as m,r as y,n as w,b as j,t as d,d as o,w as v,v as k,e as _,f as O,g as E,h as T,i as N,j as P,k as I,V as H,l as L}from"./vendor.75ed90a5.js";const R=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=r(s);fetch(s.href,n)}};R();const q={setup(t){return(e,r)=>(l(),x(A(S)))}},M="modulepreload",C={},W="./",z=function(e,r){return!r||r.length===0?e():Promise.all(r.map(a=>{if(a=`${W}${a}`,a in C)return;C[a]=!0;const s=a.endsWith(".css"),n=s?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${n}`))return;const i=document.createElement("link");if(i.rel=s?"stylesheet":M,s||(i.as="script",i.crossOrigin=""),i.href=a,document.head.appendChild(i),s)return new Promise((h,c)=>{i.addEventListener("load",h),i.addEventListener("error",c)})})).then(()=>e())};var f=(t,e)=>{const r=t.__vccOpts||t;for(const[a,s]of e)r[a]=s;return r};const D={name:"ChatElement",props:{current_chat:Array,username:String},methods:{},watch:{current_chat:{deep:!0,handler:function(t,e){setTimeout(()=>{var r=this.$refs.container;r.scrollTop=r.scrollHeight+2e3},50)}}}},K={class:"imessage flex flex-col mt-auto overflow-scroll",ref:"container"},B={class:"text-[12px]"};function J(t,e,r,a,s,n){return l(),u("div",K,[(l(!0),u(m,null,y(r.current_chat,(i,h)=>(l(),u("p",{key:i,class:w(i.username==r.username?"from-me":"from-them")},[j(d(i.text)+" ",1),o("div",B,d(i.username),1)],2))),128))],512)}var $=f(D,[["render",J],["__scopeId","data-v-3b0333dc"]]);const F={name:"home",emits:["addTube"],data(){return{tube_id:"",error_text:""}},methods:{continue:function(){},closeWindow:function(){this.$emit("close"),this.tube_id="",this.error_text=""},addTube:function(){this.tube_id!==""?this.$emit("addTube",this.tube_id):this.error_text="Diesen Tube gibt es nicht."}}},U={class:"h-screen w-screen absolute grid place-items-center"},G={class:"bg-white opacity-100 z-40 w-96 h-60 absolute rounded-2xl grid place-items-center"},Q=o("div",{class:"border-b-2 border-black-900 flex flex-row"},[o("p",{class:"flex flex-row mt-3 text-gray-700 font-bold text-lg mb-3 ml-auto mr-auto"}," Tube hinzuf\xFCgen ")],-1),X={class:"flex flex-row items-center mt-5"},Y={class:"mt-2 text-blue-800 font-bold"},Z={class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-full inline-flex mt-4 mb-5"},ee=o("i",{class:"f7-icons inset-y-0 font-light gray"}," arrow_right_circle_fill ",-1);function te(t,e,r,a,s,n){return l(),u("div",U,[o("div",{class:"bg-black opacity-60 z-30 h-screen w-screen absolute",onClick:e[0]||(e[0]=(...i)=>n.closeWindow&&n.closeWindow(...i))}),o("div",G,[Q,o("div",X,[v(o("input",{class:"appearance-none rounded-xl py-3 px-5 text-black-700 leading-tight focus:outline-none outline-0 text-xl bg-gray-200 min-w-[300px] ml-auto mr-auto",type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>s.tube_id=i),placeholder:"tube id"},null,512),[[k,s.tube_id]])]),o("p",Y,d(s.error_text),1),o("button",Z,[ee,o("span",{tag:"button",class:"ml-2 font-weight text-xl",onClick:e[2]||(e[2]=(...i)=>n.addTube&&n.addTube(...i))}," Weiter ")])])])}var se=f(F,[["render",te]]);async function ne(){return await fetch("http://127.0.0.1:4001/check_auth",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({token:localStorage.getItem("token")})}).then(e=>e.json()).then(e=>e.token).catch(e=>!1)}async function oe(){return await fetch("http://127.0.0.1:4001/check_auth",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({token:localStorage.getItem("token")})}).then(e=>e.json()).then(e=>e).catch(e=>!1)}function re(t,e,r){for(;e<0;)e+=t.length;for(;r<0;)r+=t.length;if(r>=t.length)for(var a=r-t.length+1;a--;)t.push(void 0);return t.splice(r,0,t.splice(e,1)[0]),t}const b="http://localhost:4001";var ie="./assets/no_chat.8adbd187.svg";const ae={name:"home",data(){return{username:"",message:"",add_task_view:!1,current_tube_index:0,tubes:[{tube_id:"main",name:"Hauptkanal"}],current_chat:[]}},methods:{logout:function(){localStorage.removeItem("token"),this.$router.push({path:"/auth"})},moveToTop:function(t){re(this.tubes,t,0)},showAddTubeView:function(){this.add_task_view=!this.add_task_view},addTube:function(t){this.showAddTubeView(),this.tubes.push({tube_id:t,name:t})},emitMessage:function(){fetch(b+"/emit",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({room:this.tubes[this.current_tube_index].tube_id,message:this.message,token:localStorage.getItem("token")})}).then(t=>t.json()).then(t=>{}).catch(t=>{console.log("Request failed",t)})},selectTube:function(t,e){this.$socket.emit("unsubscribe",this.tubes[this.current_tube_index].tube_id),this.current_tube_index=e,this.$socket.emit("subscribe",this.tubes[this.current_tube_index].tube_id),this.current_chat=[],this.fetchTubeHistory()},fetchTubeHistory:function(){fetch(b+"/get_tube",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({tube_id:this.tubes[this.current_tube_index].tube_id,token:localStorage.getItem("token")})}).then(t=>t.json()).then(t=>{console.log(t),this.current_chat=t.messages}).catch(t=>{console.log("Request failed",t)})}},sockets:{connect:function(){},message:function(t){this.current_chat.push({text:t.message,username:t.author})}},components:{ChatElement:$,NewChatView:se},mounted:async function(){const t=await oe();this.username=t.user.username,this.$socket.emit("subscribe",this.tubes[this.current_tube_index].tube_id),this.fetchTubeHistory()}},ce={class:"flex justify-center bg-individual h-screen p-10"},le={class:"flex flex-row w-11/12 bg-white rounded-xl shadow-2xl"},ue={class:"flex flex-col bg-white-800 w-96 border-r-2 border-black-900"},de={class:"flex flex-row border-b-2 border-black-900 w-full justify-between static"},he={class:"text-xl text-indigo font-sans mt-3 ml-2 px-3 py-2 mb-3"},me={class:"mt-3"},_e=["onClick"],fe={class:"text-base text-black font-extrabold"},be={class:"text-base text-slate-400 font-regular"},pe={key:0,class:"flex flex-col w-full"},ge={class:"flex flex-row border-b-2 border-black-900 w-full justify-between"},xe={class:"text-xl text-indigo font-sans mt-2 px-3 py-2 mb-4"},ye={class:"flex items-center"},we={class:"mr-5 bg-gray-800 text-white p-1.5 px-3 rounded-full"},ve={class:"flex flex-row border-t-2 border-black-900 w-full justify-between static"},ke={key:1,class:"grid content-center mr-auto ml-auto"},Te=o("img",{src:ie,alt:"alt",class:"w-36 ml-auto mr-auto"},null,-1),Ce=o("p",{class:"mt-10 text-gray-700 font-light text-3xl ml-auto mr-auto"}," Hier ist es aber leise... ",-1),Ve=o("span",{tag:"button",class:"font-weight text-xl"},"Tube hinzuf\xFCgen",-1),Ae=[Ve];function Se(t,e,r,a,s,n){const i=T("NewChatView"),h=T("ChatElement");return l(),u(m,null,[s.add_task_view?(l(),x(i,{key:0,onAddTube:n.addTube,onClose:n.showAddTubeView},null,8,["onAddTube","onClose"])):_("",!0),o("div",ce,[o("div",le,[o("div",ue,[o("div",de,[o("p",he,d(s.username),1),o("div",me,[o("i",{class:"f7-icons mr-2 inset-y-0 font-light hover:bg-gray-200 hover:cursor-pointer p-2 rounded-full",onClick:e[0]||(e[0]=(...c)=>n.logout&&n.logout(...c))}," lock "),o("i",{class:"f7-icons inset-y-0 mr-2 font-light hover:bg-gray-200 hover:cursor-pointer p-2 rounded-full",onClick:e[1]||(e[1]=(...c)=>n.showAddTubeView&&n.showAddTubeView(...c))}," paperplane ")])]),(l(!0),u(m,null,y(s.tubes,(c,g)=>(l(),u("div",{class:"flex flex-col max-h-90 overflow-auto",key:c.tube_id},[o("div",{onClick:Oe=>n.selectTube(c,g),class:w(["h-15 px-5 py-5",g==s.current_tube_index?"bg-gray-200":"bg-white"])},[o("p",fe,d(c.name),1),o("p",be,d(c.tube_id),1)],10,_e)]))),128))]),s.tubes.length>0?(l(),u("div",pe,[o("div",ge,[o("p",xe,d(s.tubes[s.current_tube_index].name),1),o("div",ye,[o("p",we,d(this.tubes[this.current_tube_index].tube_id),1)])]),O(h,{current_chat:s.current_chat,username:s.username},null,8,["current_chat","username"]),o("div",ve,[v(o("input",{class:"appearance-none rounded w-full py-2 px-3 ml-4 text-black-700 leading-tight focus:outline-none outline-0 text-xl",type:"text",placeholder:"Geben Sie eine Nachricht ein...",onKeyup:e[2]||(e[2]=E((...c)=>n.emitMessage&&n.emitMessage(...c),["enter"])),"onUpdate:modelValue":e[3]||(e[3]=c=>s.message=c)},null,544),[[k,s.message]]),o("i",{class:"f7-icons mt-5 ml-2 inset-y-0 mr-4 font-light mb-5",onClick:e[4]||(e[4]=(...c)=>n.emitMessage&&n.emitMessage(...c))}," paperplane_fill ")])])):_("",!0),s.tubes.length==0?(l(),u("div",ke,[Te,Ce,o("button",{onClick:e[5]||(e[5]=(...c)=>n.showAddTubeView&&n.showAddTubeView(...c)),class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-full inline-flex mt-10 w-50 mr-auto ml-auto"},Ae)])):_("",!0)])])],64)}var je=f(ae,[["render",Se]]);const V=N({history:P("./"),routes:[{path:"/",name:"home",component:je,meta:{requiresAuth:!0}},{path:"/auth",name:"auth",component:()=>z(()=>import("./AuthView.7b90d821.js"),["assets/AuthView.7b90d821.js","assets/AuthView.fecce7df.css","assets/vendor.75ed90a5.js"])}]});V.beforeEach(async(t,e,r)=>{var a=await ne();console.log(a),t.matched.some(s=>s.meta.requiresAuth)?a?r():r({name:"auth"}):r()});const p=I(q);p.use(V);p.use(new H({debug:!0,connection:L(b),vuex:{actionPrefix:"SOCKET_",mutationPrefix:"SOCKET_"}}));p.mount("#app");export{f as _,b as s};
